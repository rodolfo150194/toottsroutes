---
import Layout from "@layouts/Layout.astro";
import Header from "@sections/Header.astro";
import Footer from "@sections/Footer.astro";
import { Icon } from "astro-icon/components";

const searchableContent = [
  {
    title: "Transporte Maritimo",
    description: "Envio de contenedores internacionales por via maritima. Contenedores refrigerados, dry y especiales.",
    url: "/servicios/maritimo",
    category: "Servicios",
    icon: "tabler:ship",
    keywords: ["maritimo", "barco", "contenedor", "puerto", "buque", "mar", "oceano", "refrigerado", "fcl", "lcl"],
  },
  {
    title: "Transporte Aereo",
    description: "Envios express por via aerea. Paqueteria por peso con entrega rapida a nivel mundial.",
    url: "/servicios/aereo",
    category: "Servicios",
    icon: "tabler:plane",
    keywords: ["aereo", "avion", "vuelo", "express", "rapido", "urgente", "paquete", "carga aerea"],
  },
  {
    title: "Transporte Terrestre",
    description: "Distribucion local y regional por carretera. Camiones completos y grupaje.",
    url: "/servicios/terrestre",
    category: "Servicios",
    icon: "tabler:truck",
    keywords: ["terrestre", "camion", "carretera", "trailer", "furgoneta", "reparto", "local", "regional"],
  },
  {
    title: "Almacenamiento",
    description: "Deposito y gestion de carga. Almacenes con control de temperatura y seguridad.",
    url: "/servicios/almacenamiento",
    category: "Servicios",
    icon: "tabler:building-warehouse",
    keywords: ["almacen", "deposito", "bodega", "inventario", "stock", "guardamuebles", "temperatura"],
  },
  {
    title: "Todos los Servicios",
    description: "Catalogo completo de servicios logisticos de Rootts & Routes.",
    url: "/servicios",
    category: "Servicios",
    icon: "tabler:list",
    keywords: ["servicios", "catalogo", "todos", "completo"],
  },
  {
    title: "Rastreo de Envios",
    description: "Seguimiento en tiempo real de tu carga. Introduce tu codigo de tracking.",
    url: "/rastreo",
    category: "Herramientas",
    icon: "tabler:map-pin",
    keywords: ["rastreo", "rastrear", "seguimiento", "tracking", "envio", "paquete", "donde", "estado", "ubicacion"],
  },
  {
    title: "Contacto",
    description: "Contacta con nuestro equipo. Telefono, email y formulario de contacto.",
    url: "/contacto",
    category: "Informacion",
    icon: "tabler:mail",
    keywords: ["contacto", "telefono", "email", "mensaje", "formulario", "ayuda", "soporte", "atencion"],
  },
  {
    title: "Cotizacion",
    description: "Solicita una cotizacion personalizada para tu envio.",
    url: "/contacto",
    category: "Herramientas",
    icon: "tabler:calculator",
    keywords: ["cotizacion", "cotizar", "precio", "presupuesto", "tarifa", "costo", "cuanto"],
  },
  {
    title: "Inicio",
    description: "Pagina principal de Rootts & Routes Foods S.L.U.",
    url: "/",
    category: "Navegacion",
    icon: "tabler:home",
    keywords: ["inicio", "home", "principal", "rootts", "routes"],
  },
];

const query = Astro.url.searchParams.get("q")?.toLowerCase().trim() || "";

let results: typeof searchableContent = [];

if (query) {
  results = searchableContent.filter((item) => {
    const searchText = `${item.title} ${item.description} ${item.keywords.join(" ")}`.toLowerCase();
    const queryWords = query.split(" ");
    return queryWords.some((word) => searchText.includes(word));
  });
}
---

<Layout>
  <Header />

  <section class="relative pt-32 pb-16 md:pt-40 md:pb-20 bg-azul-marino-950 overflow-hidden">
    <div class="absolute inset-0 opacity-[0.02]" style="background-image: linear-gradient(rgba(111,182,63,0.5) 1px, transparent 1px), linear-gradient(90deg, rgba(111,182,63,0.5) 1px, transparent 1px); background-size: 60px 60px;"></div>

    <div class="relative max-w-4xl mx-auto px-4 md:px-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
          Resultados de busqueda
        </h1>
        {query && (
          <p class="text-azul-marino-200">
            Buscando: <span class="text-verde-global-400 font-medium">"{query}"</span>
          </p>
        )}
      </div>

      <form action="/buscar" method="GET" class="relative">
        <Icon name="tabler:search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-azul-marino-400" />
        <input
          type="text"
          name="q"
          value={query}
          placeholder="Buscar servicios, rastreo, informacion..."
          autocomplete="off"
          class="w-full bg-azul-marino-800/60 border border-azul-marino-600/50 text-white placeholder-azul-marino-400 rounded-xl py-4 pl-12 pr-32 focus:outline-none focus:border-verde-global-500 focus:ring-1 focus:ring-verde-global-500/50 transition-all duration-200"
        />
        <button
          type="submit"
          class="absolute right-2 top-1/2 -translate-y-1/2 bg-verde-global-500 hover:bg-verde-global-400 text-azul-marino-950 font-bold py-2.5 px-5 rounded-lg transition-colors"
        >
          Buscar
        </button>
      </form>
    </div>
  </section>

  <section class="py-12 md:py-16 bg-gray-50 min-h-[50vh]">
    <div class="max-w-4xl mx-auto px-4 md:px-8">
      {!query ? (
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-azul-marino-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <Icon name="tabler:search" class="w-8 h-8 text-azul-marino-400" />
          </div>
          <h2 class="text-xl font-bold text-azul-marino-950 mb-2">Ingresa un termino de busqueda</h2>
          <p class="text-azul-marino-500">Escribe lo que buscas en el campo de arriba.</p>

          <div class="mt-8">
            <p class="text-azul-marino-400 text-sm mb-4">Busquedas populares:</p>
            <div class="flex flex-wrap justify-center gap-2">
              <a href="/buscar?q=maritimo" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Transporte Maritimo</a>
              <a href="/buscar?q=rastreo" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Rastrear Envio</a>
              <a href="/buscar?q=cotizacion" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Cotizacion</a>
              <a href="/buscar?q=contacto" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Contacto</a>
            </div>
          </div>
        </div>
      ) : results.length > 0 ? (
        <div>
          <p class="text-azul-marino-500 mb-6">
            {results.length} {results.length === 1 ? "resultado encontrado" : "resultados encontrados"}
          </p>

          <div class="space-y-4">
            {results.map((item) => (
              <a
                href={item.url}
                class="group block bg-white border border-gray-100 hover:border-verde-global-500/30 rounded-2xl p-6 shadow-sm hover:shadow-lg transition-all duration-300"
              >
                <div class="flex items-start gap-4">
                  <div class="w-12 h-12 bg-azul-marino-50 group-hover:bg-verde-global-500/10 rounded-xl flex items-center justify-center flex-shrink-0 transition-colors">
                    <Icon name={item.icon} class="w-6 h-6 text-azul-marino-600 group-hover:text-verde-global-600 transition-colors" />
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-xs text-azul-marino-400 bg-azul-marino-50 px-2 py-0.5 rounded">{item.category}</span>
                    </div>
                    <h3 class="text-azul-marino-950 font-bold text-lg group-hover:text-verde-global-600 transition-colors mb-1">
                      {item.title}
                    </h3>
                    <p class="text-azul-marino-500 text-sm line-clamp-2">{item.description}</p>
                    <p class="text-verde-global-600 text-xs mt-2 flex items-center gap-1">
                      <span>{item.url}</span>
                      <Icon name="tabler:arrow-right" class="w-3 h-3 group-hover:translate-x-1 transition-transform" />
                    </p>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      ) : (
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <Icon name="tabler:search-off" class="w-8 h-8 text-red-500" />
          </div>
          <h2 class="text-xl font-bold text-azul-marino-950 mb-2">Sin resultados</h2>
          <p class="text-azul-marino-500 mb-6">
            No encontramos resultados para "<span class="font-medium">{query}</span>".
          </p>

          <div class="bg-white border border-gray-100 rounded-2xl p-6 max-w-md mx-auto">
            <h3 class="text-azul-marino-950 font-medium mb-3">Sugerencias:</h3>
            <ul class="text-azul-marino-500 text-sm text-left space-y-2">
              <li class="flex items-start gap-2">
                <Icon name="tabler:check" class="w-4 h-4 text-verde-global-500 mt-0.5 flex-shrink-0" />
                <span>Verifica la ortografia de las palabras</span>
              </li>
              <li class="flex items-start gap-2">
                <Icon name="tabler:check" class="w-4 h-4 text-verde-global-500 mt-0.5 flex-shrink-0" />
                <span>Intenta con terminos mas generales</span>
              </li>
              <li class="flex items-start gap-2">
                <Icon name="tabler:check" class="w-4 h-4 text-verde-global-500 mt-0.5 flex-shrink-0" />
                <span>Usa palabras clave como: maritimo, aereo, rastreo</span>
              </li>
            </ul>
          </div>

          <div class="mt-8">
            <p class="text-azul-marino-400 text-sm mb-4">Prueba con:</p>
            <div class="flex flex-wrap justify-center gap-2">
              <a href="/buscar?q=maritimo" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Maritimo</a>
              <a href="/buscar?q=aereo" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Aereo</a>
              <a href="/buscar?q=rastreo" class="px-4 py-2 bg-white border border-gray-200 hover:border-verde-global-500 rounded-lg text-azul-marino-700 text-sm transition-colors">Rastreo</a>
            </div>
          </div>
        </div>
      )}
    </div>
  </section>

  <Footer />
</Layout>
